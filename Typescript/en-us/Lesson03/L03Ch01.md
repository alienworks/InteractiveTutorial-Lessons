---
title: "Dice"
actions: ['checkAnswer', 'hints']
material: 
  editor:
    language: typescript
    startingCode: |
        import {
            SmartContract,
            SerializableValueObject,
            MapStorage,
            constant,
            Blockchain,
            createEventNotifier,
            Address,
            Deploy
        } from '@neo-one/smart-contract';

        interface Alien extends SerializableValueObject {
            xna: number;
            readonly alienName: string;
            readonly blockHeight: number;
            readonly id: number;
        }

        const notifyCreation = createEventNotifier<number>(
            'generate',
            'id'
        );

        export class AlienFinder extends SmartContract {

            private readonly aliens = MapStorage.for<number, Alien>();

            private counter: number = 0; 

            public constructor(public readonly owner: Address = Deploy.senderAddress) {
                super();
            }

            public generateAlien(alienName: string) {
                if (!Address.isCaller(this.owner)) {
                    throw new Error('Expected caller to be the owner');
                }

                let blockHeight: number = Blockchain.currentHeight;
                let xna: number = this.findXna(this.randomNumber(blockHeight));
                let id: number = ++this.counter;
                let someAlien: Alien = {xna: xna, alienName: alienName, blockHeight: blockHeight, id: id};
                this.aliens.set(id, someAlien);
                notifyCreation(someAlien.id);
            }

            @constant
            private randomNumber(blockHeight: number): number {
                return Blockchain.currentBlockTime * blockHeight;
            }

            @constant
            private findXna(randomNumber: number): number {
                return randomNumber % 1E8;
            }

            @constant
            public query(id: number): Alien {
                const alien = this.aliens.get(id);
                if (alien === undefined) {
                    throw new Error('Alien not found');
                }
                else {
                    return alien;
                }
            }

            public mutate(id: number, attribute: number) {
                let a: Alien = this.query(id);
                let blockHeight: number = Blockchain.currentHeight;
                let randomDigit: number = this.randomNumber(blockHeight) % 100;

                switch(attribute) {
                    case 0: {
                        let right: number = a.xna % 1E6;
                        a.xna = randomDigit * 1E6 + right;
                        this.aliens.set(id, a);
                        break;
                    }
                    case 1: {
                        let left: number = a.xna / 1E6;
                        let right: number = a.xna % 1E4;
                        a.xna = left * 1E6 + randomDigit * 1E4 + right;
                        this.aliens.set(id, a);
                        break;
                    }
                    case 2: {
                        let left: number = a.xna / 1E4;
                        let right: number = a.xna % 1E2;
                        a.xna = left * 1E4 + randomDigit * 1E2 + right;
                        this.aliens.set(id, a);
                        break;
                    }
                    case 3: {
                        let left: number = a.xna / 1E2;
                        a.xna = left * 1E2 + randomDigit;
                        this.aliens.set(id, a);
                        break;
                    }
                    default: {
                        break;
                    }
                }
            }

            // Add the new methods here
        }
    answer: > 
        import {
            SmartContract,
            SerializableValueObject,
            MapStorage,
            constant,
            Blockchain,
            createEventNotifier,
            Address,
            Deploy
        } from '@neo-one/smart-contract';

        interface Alien extends SerializableValueObject {
            xna: number;
            readonly alienName: string;
            readonly blockHeight: number;
            readonly id: number;
        }

        const notifyCreation = createEventNotifier<number>(
            'generate',
            'id'
        );

        export class AlienFinder extends SmartContract {

            private readonly aliens = MapStorage.for<number, Alien>();

            private counter: number = 0; 

            public constructor(public readonly owner: Address = Deploy.senderAddress) {
                super();
            }

            public generateAlien(alienName: string) {
                if (!Address.isCaller(this.owner)) {
                    throw new Error('Expected caller to be the owner');
                }

                let blockHeight: number = Blockchain.currentHeight;
                let xna: number = this.findXna(this.randomNumber(blockHeight));
                let id: number = ++this.counter;
                let someAlien: Alien = {xna: xna, alienName: alienName, blockHeight: blockHeight, id: id};
                this.aliens.set(id, someAlien);
                notifyCreation(someAlien.id);
            }

            @constant
            private randomNumber(blockHeight: number): number {
                return Blockchain.currentBlockTime * blockHeight;
            }

            @constant
            private findXna(randomNumber: number): number {
                return randomNumber % 1E8;
            }

            @constant
            public query(id: number): Alien {
                const alien = this.aliens.get(id);
                if (alien === undefined) {
                    throw new Error('Alien not found');
                }
                else {
                    return alien;
                }
            }

            public mutate(id: number, attribute: number) {
                let a: Alien = this.query(id);
                let blockHeight: number = Blockchain.currentHeight;
                let randomDigit: number = this.randomNumber(blockHeight) % 100;

                switch(attribute) {
                    case 0: {
                        let right: number = a.xna % 1E6;
                        a.xna = randomDigit * 1E6 + right;
                        this.aliens.set(id, a);
                        break;
                    }
                    case 1: {
                        let left: number = a.xna / 1E6;
                        let right: number = a.xna % 1E4;
                        a.xna = left * 1E6 + randomDigit * 1E4 + right;
                        this.aliens.set(id, a);
                        break;
                    }
                    case 2: {
                        let left: number = a.xna / 1E4;
                        let right: number = a.xna % 1E2;
                        a.xna = left * 1E4 + randomDigit * 1E2 + right;
                        this.aliens.set(id, a);
                        break;
                    }
                    case 3: {
                        let left: number = a.xna / 1E2;
                        a.xna = left * 1E2 + randomDigit;
                        this.aliens.set(id, a);
                        break;
                    }
                    default: {
                        break;
                    }
                }
            }

            @constant
            public d6(): number {
                return this.randomNumber(Blockchain.currentHeight) % 6;
            }

            @constant
            public d10(): number {
                return this.randomNumber(Blockchain.currentHeight) % 10;
            }

            @constant
            public d100(): number {
                return this.randomNumber(Blockchain.currentHeight) % 100;
            }

            @constant
            public dN(n: number): number {
                return this.randomNumber(Blockchain.currentHeight) % n + 1;
            }
        }
---

In this tutorial, we will build a DnD adventure game. Our Aliens will explore the contract world, come across many random events and get corresponding rewards and punishments. The stronger they are, the more possible that they can conquer. Through a multi-level attribute promotion, our Aliens will change they life forms and get evolved.

> DnD and ADnD games are those based on the popular Dungeon and Dragons, or Advanced Dungeon and Dragons fantasy role-playing games. Such games will contain elements identical to other role-playing games but will be based on the DnD intellectual property and/or will use a DnD or ADnD rule set.

There are three core concepts in DnD games - story, rule set and dice. The story defines the game background and settings. The rule set defines what happends and why, when, where and how they happen. And the dice decides the result of every event. 

First of all, let's build the most basic one - dice.

In this game, we need four kinds of dice,
- D6 - decide what will happen when Aliens are exploring.
- D10 - determine the amount of attribute rewards or punishments.
- D100 - judge the result of every event.
- Dn - select the enemy that Aliens will meet.

### Instructions

- Implement the methods `d6()`, `d10()`, and `d100()`. Each of them takes the result from the method `randomNumber()` as input, and return another positive random number smaller than 6, 10, and 100.
- Implement the methods `dn()`. It takes the amount of Aliens as `n`, and returns a random Alien id.