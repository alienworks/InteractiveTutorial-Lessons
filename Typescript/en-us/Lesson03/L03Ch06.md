---
title: "Step forwrd"
actions: ['checkAnswer', 'hints']
material: 
  editor:
    language: typescript
    startingCode: |
        import {
            SmartContract,
            SerializableValueObject,
            MapStorage,
            constant,
            Blockchain,
            createEventNotifier,
            Address,
            Deploy
        } from '@neo-one/smart-contract';

        interface Alien extends SerializableValueObject {
            xna: number;
            readonly alienName: string;
            readonly blockHeight: number;
            readonly id: number;
        }

        const notifyCreation = createEventNotifier<number>(
            'generate',
            'id'
        );

        // Add the new event notifier here

        const notifyReward = createEventNotifier<string, number>(
            'reward',
            'attribute',
            'value'
        );

        const notifyPunishment = createEventNotifier<string, number>(
            'punish',
            'attribute',
            'value'
        );

        export class AlienFinder extends SmartContract {

            private readonly aliens = MapStorage.for<number, Alien>();

            private counter: number = 0; 

            public constructor(public readonly owner: Address = Deploy.senderAddress) {
                super();
            }

            public generateAlien(alienName: string) {
                if (!Address.isCaller(this.owner)) {
                    throw new Error('Expected caller to be the owner');
                }

                let blockHeight: number = Blockchain.currentHeight;
                let xna: number = this.findXna(this.randomNumber(blockHeight));
                let id: number = ++this.counter;
                let someAlien: Alien = {xna: xna, alienName: alienName, blockHeight: blockHeight, id: id};
                this.aliens.set(id, someAlien);
                notifyCreation(someAlien.id);
            }

            @constant
            private randomNumber(blockHeight: number): number {
                return Blockchain.currentBlockTime * blockHeight;
            }

            @constant
            private findXna(randomNumber: number): number {
                return randomNumber % 1E8;
            }

            @constant
            public query(id: number): Alien {
                const alien = this.aliens.get(id);
                if (alien === undefined) {
                    throw new Error('Alien not found');
                }
                else {
                    return alien;
                }
            }

            public mutate(id: number, attribute: number) {
                let a: Alien = this.query(id);
                let blockHeight: number = Blockchain.currentHeight;
                let randomDigit: number = this.randomNumber(blockHeight) % 100;

                switch(attribute) {
                    case 0: {
                        let right: number = a.xna % 1E6;
                        a.xna = randomDigit * 1E6 + right;
                        this.aliens.set(id, a);
                        break;
                    }
                    case 1: {
                        let left: number = a.xna / 1E6;
                        let right: number = a.xna % 1E4;
                        a.xna = left * 1E6 + randomDigit * 1E4 + right;
                        this.aliens.set(id, a);
                        break;
                    }
                    case 2: {
                        let left: number = a.xna / 1E4;
                        let right: number = a.xna % 1E2;
                        a.xna = left * 1E4 + randomDigit * 1E2 + right;
                        this.aliens.set(id, a);
                        break;
                    }
                    case 3: {
                        let left: number = a.xna / 1E2;
                        a.xna = left * 1E2 + randomDigit;
                        this.aliens.set(id, a);
                        break;
                    }
                    default: {
                        break;
                    }
                }
            }

            @constant
            public d6(): number {
                return this.randomNumber(Blockchain.currentHeight) % 6;
            }

            @constant
            public d10(): number {
                return this.randomNumber(Blockchain.currentHeight) % 10;
            }

            @constant
            public d100(): number {
                return this.randomNumber(Blockchain.currentHeight) % 100;
            }

            @constant
            public dN(n: number): number {
                return this.randomNumber(Blockchain.currentHeight) % n + 1;
            }

            private reward(alien: Alien) {
                let attribute: number = this.d6() / 2;
                let value: number = this.d10();

                switch(attribute) {
                    case 0: {
                        alien.xna += value * 1E4;
                        notifyReward('strength', value);
                        this.aliens.set(alien.id, alien);
                        break;
                    }
                    case 1: {
                        alien.xna += value * 1E2;
                        notifyReward('speed', value);
                        this.aliens.set(alien.id, alien);
                        break;
                    }
                    case 2: {
                        alien.xna += value;
                        notifyReward('weight', value);
                        this.aliens.set(alien.id, alien);
                        break;
                    }
                    default: {
                        break;
                    }
                }
            }

            private punish(alien: Alien) {
                let attribute: number = this.d6() / 2;
                let value: number = this.d10();

                switch(attribute) {
                    case 0: {
                        alien.xna -= this.d10() * 1E4;
                        notifyPunishment('strength', value);
                        this.aliens.set(alien.id, alien);
                        break;
                    }
                    case 1: {
                        alien.xna -= this.d10() * 1E2;
                        notifyPunishment('speed', value);
                        this.aliens.set(alien.id, alien);
                        break;
                    }
                    case 2: {
                        alien.xna -= this.d10();
                        notifyPunishment('weight', value);
                        this.aliens.set(alien.id, alien);
                        break;
                    }
                    default: {
                        break;
                    }
                }
            }

            private judge(alien: Alien, value: number) {
                if (value + this.d100() > 100) {
                    this.reward(alien);
                }
                else {
                    this.punish(alien);
                }
            }

            private fight(alien: Alien, enemy: Alien) {
                let strength: number = alien.xna % 1E6 / 1E4;
                let speed: number = alien.xna % 1E4 / 1E2;
                let weight: number = alien.xna % 1E2;

                let enemyStrength: number = enemy.xna % 1E6 / 1E4;
                let enemySpeed: number = enemy.xna % 1E4 / 1E2;
                let enemyWeight: number = enemy.xna % 1E2;

                let score: number = 0;
                if (strength > enemyStrength) {
                    score++;
                }
                if (speed > enemySpeed) {
                    score++;
                }
                if (weight > enemyWeight) {
                    score++;
                }
                
                if (score > 1) {
                    this.reward(alien);
                }
                else {
                    this.punish(alien);
                }
            }

            // Add the new method here
        }
    answer: > 
        import {
            SmartContract,
            SerializableValueObject,
            MapStorage,
            constant,
            Blockchain,
            createEventNotifier,
            Address,
            Deploy
        } from '@neo-one/smart-contract';

        interface Alien extends SerializableValueObject {
            xna: number;
            readonly alienName: string;
            readonly blockHeight: number;
            readonly id: number;
        }

        const notifyCreation = createEventNotifier<number>(
            'generate',
            'id'
        );

        const notifyEvent = createEventNotifier<string, number>(
            'event',
            'name',
            'id'
        );

        const notifyReward = createEventNotifier<string, number>(
            'reward',
            'attribute',
            'value'
        );

        const notifyPunishment = createEventNotifier<string, number>(
            'punish',
            'attribute',
            'value'
        );

        export class AlienFinder extends SmartContract {

            private readonly aliens = MapStorage.for<number, Alien>();

            private counter: number = 0; 

            public constructor(public readonly owner: Address = Deploy.senderAddress) {
                super();
            }

            public generateAlien(alienName: string) {
                if (!Address.isCaller(this.owner)) {
                    throw new Error('Expected caller to be the owner');
                }

                let blockHeight: number = Blockchain.currentHeight;
                let xna: number = this.findXna(this.randomNumber(blockHeight));
                let id: number = ++this.counter;
                let someAlien: Alien = {xna: xna, alienName: alienName, blockHeight: blockHeight, id: id};
                this.aliens.set(id, someAlien);
                notifyCreation(someAlien.id);
            }

            @constant
            private randomNumber(blockHeight: number): number {
                return Blockchain.currentBlockTime * blockHeight;
            }

            @constant
            private findXna(randomNumber: number): number {
                return randomNumber % 1E8;
            }

            @constant
            public query(id: number): Alien {
                const alien = this.aliens.get(id);
                if (alien === undefined) {
                    throw new Error('Alien not found');
                }
                else {
                    return alien;
                }
            }

            public mutate(id: number, attribute: number) {
                let a: Alien = this.query(id);
                let blockHeight: number = Blockchain.currentHeight;
                let randomDigit: number = this.randomNumber(blockHeight) % 100;

                switch(attribute) {
                    case 0: {
                        let right: number = a.xna % 1E6;
                        a.xna = randomDigit * 1E6 + right;
                        this.aliens.set(id, a);
                        break;
                    }
                    case 1: {
                        let left: number = a.xna / 1E6;
                        let right: number = a.xna % 1E4;
                        a.xna = left * 1E6 + randomDigit * 1E4 + right;
                        this.aliens.set(id, a);
                        break;
                    }
                    case 2: {
                        let left: number = a.xna / 1E4;
                        let right: number = a.xna % 1E2;
                        a.xna = left * 1E4 + randomDigit * 1E2 + right;
                        this.aliens.set(id, a);
                        break;
                    }
                    case 3: {
                        let left: number = a.xna / 1E2;
                        a.xna = left * 1E2 + randomDigit;
                        this.aliens.set(id, a);
                        break;
                    }
                    default: {
                        break;
                    }
                }
            }

            @constant
            public d6(): number {
                return this.randomNumber(Blockchain.currentHeight) % 6;
            }

            @constant
            public d10(): number {
                return this.randomNumber(Blockchain.currentHeight) % 10;
            }

            @constant
            public d100(): number {
                return this.randomNumber(Blockchain.currentHeight) % 100;
            }

            @constant
            public dN(n: number): number {
                return this.randomNumber(Blockchain.currentHeight) % n + 1;
            }

            private reward(alien: Alien) {
                let attribute: number = this.d6() / 2;
                let value: number = this.d10();

                switch(attribute) {
                    case 0: {
                        alien.xna += value * 1E4;
                        notifyReward('strength', value);
                        this.aliens.set(alien.id, alien);
                        break;
                    }
                    case 1: {
                        alien.xna += value * 1E2;
                        notifyReward('speed', value);
                        this.aliens.set(alien.id, alien);
                        break;
                    }
                    case 2: {
                        alien.xna += value;
                        notifyReward('weight', value);
                        this.aliens.set(alien.id, alien);
                        break;
                    }
                    default: {
                        break;
                    }
                }
            }

            private punish(alien: Alien) {
                let attribute: number = this.d6() / 2;
                let value: number = this.d10();

                switch(attribute) {
                    case 0: {
                        alien.xna -= this.d10() * 1E4;
                        notifyPunishment('strength', value);
                        this.aliens.set(alien.id, alien);
                        break;
                    }
                    case 1: {
                        alien.xna -= this.d10() * 1E2;
                        notifyPunishment('speed', value);
                        this.aliens.set(alien.id, alien);
                        break;
                    }
                    case 2: {
                        alien.xna -= this.d10();
                        notifyPunishment('weight', value);
                        this.aliens.set(alien.id, alien);
                        break;
                    }
                    default: {
                        break;
                    }
                }
            }

            private judge(alien: Alien, value: number) {
                if (value + this.d100() > 100) {
                    this.reward(alien);
                }
                else {
                    this.punish(alien);
                }
            }

            private fight(alien: Alien, enemy: Alien) {
                let strength: number = alien.xna % 1E6 / 1E4;
                let speed: number = alien.xna % 1E4 / 1E2;
                let weight: number = alien.xna % 1E2;

                let enemyStrength: number = enemy.xna % 1E6 / 1E4;
                let enemySpeed: number = enemy.xna % 1E4 / 1E2;
                let enemyWeight: number = enemy.xna % 1E2;

                let score: number = 0;
                if (strength > enemyStrength) {
                    score++;
                }
                if (speed > enemySpeed) {
                    score++;
                }
                if (weight > enemyWeight) {
                    score++;
                }
                
                if (score > 1) {
                    this.reward(alien);
                }
                else {
                    this.punish(alien);
                }
            }

            public forward(id: number) {
                let alien: Alien = this.query(id);
                let event: number = this.d6();

                switch(event) {
                    case 0: {
                        let strength: number = alien.xna % 1E6 / 1E4;
                        notifyEvent('strength', id);
                        this.judge(alien, strength);
                        break;
                    }
                    case 1: {
                        let speed: number = alien.xna % 1E4 / 1E2;
                        notifyEvent('speed', id);
                        this.judge(alien, speed);
                        break;
                    }
                    case 2: {
                        let weight: number = alien.xna % 1E2;
                        notifyEvent('weight', id);
                        this.judge(alien, 100 - weight);
                        break;
                    }
                    case 3: {
                        notifyEvent('battle', id);
                        let enemy = this.query(this.dN(this.counter))
                        this.fight(alien, enemy);
                        break;
                    }
                    case 4: {
                        notifyEvent('reward', id);
                        this.reward(alien);
                        break;
                    }
                    case 5: {
                        notifyEvent('punish', id);
                        this.punish(alien);
                        break;
                    }
                    default: {
                        break;
                    }
                }
            }
        }
---

As the previous chapters have define the basic rules in our game, let's connect them up and allow the Alien to take the first step.

There are two parts missing from our story - which event to take place and which Aliens to come across. Well, to make it easy, we make it randomly.

#### Event Selection

There are six events in our games,
1. Reward Event - the current Alien will be rewarded directly. For example, some treasures.
2. Punish Event - the current Alien will be punished directly. For example, some traps.
3. Battle Event - the current Alien will fight with another one, get rewarded if it wins, otherwise get punished.
4. Strength Event - the current Alien's strength will be checked. The higher the value, the higher the success rate.
5. Speed Event - the current Alien's speed will be checked. The higher the value, the higher the success rate.
6. Weight Event - the current Alien's weight will be checked. The **lower** the value, the higher the success rate.

To select a event randomly, the D6 is needed.

#### Enemy Selection

As we didn't define the object `Enemy`, there is no villain in the game, and battles only happened between Aliens. It doesn't means that the current player's Alien is attacking other's.

The enemy in our games are wild Aliens, but their attributes are actually from other player's Aliens. So, the battle results won't influent their attributes and cause any damage to other players.

To select an enemy randomly, the Dn is needed.

### Instructions

- Add a new event notifier called `notifyEvent`, which takes the event name and the current alien's ID as input.
- Add a new method called `forward`, which takes the current alien's ID as input.
- In this method, use `d6()` to select the event first, the number `0` means a strength event, the number `1` means a speed event, the number `2` means a weight event, the number `3` means a battle event, the number `4` means a reward event, and the number `5` means a punish event.
- If there is a battle, use `dn()` to select the enemy and called the method `fight`.